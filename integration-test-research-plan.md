# VSCodeæ’ä»¶é›†æˆæµ‹è¯•æ–¹æ¡ˆ - @vscode/test-electron

## é¡¹ç›®ç°çŠ¶åˆ†æ

### æ’ä»¶åŸºæœ¬ä¿¡æ¯
- **æ’ä»¶åç§°**: auto-copilot-context
- **ç‰ˆæœ¬**: 0.2.4
- **ç±»å‹**: æ–‡ä»¶ä¸Šä¸‹æ–‡è¿½è¸ªæ’ä»¶
- **ä¸»è¦åŠŸèƒ½**: ç›‘å¬VSCodeä¸­æ‰“å¼€çš„æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨æ”¶é›†æ–‡ä»¶å†…å®¹å¹¶è¾“å‡ºåˆ°å¤šç§æ ¼å¼(XMLã€Markdownç­‰)

### ç°æœ‰æµ‹è¯•æ¶æ„
- **æµ‹è¯•æ¡†æ¶**: Mocha + @vscode/test-electron
- **æµ‹è¯•ç»“æ„**: 
  - `src/test/runTest.ts` - æµ‹è¯•è¿è¡Œå™¨
  - `src/test/suite/index.ts` - Mochaé…ç½®
  - `src/test/suite/extension.test.ts` - åŸºç¡€ç¤ºä¾‹æµ‹è¯•
  - `src/test/suite/contextTracker.test.ts` - æ ¸å¿ƒç»„ä»¶æµ‹è¯•
  - `src/test/suite/outputWriter.test.ts` - è¾“å‡ºå†™å…¥æµ‹è¯•

### æ ¸å¿ƒç»„ä»¶æ¶æ„
```
src/
â”œâ”€â”€ extension.ts                    # æ’ä»¶å…¥å£ç‚¹
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ ContextTracker.ts          # æ ¸å¿ƒè¿½è¸ªå™¨
â”‚   â””â”€â”€ FileCollector.ts           # æ–‡ä»¶æ”¶é›†å™¨
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ConfigurationManager.ts    # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ FileFilter.ts             # æ–‡ä»¶è¿‡æ»¤
â”‚   â”œâ”€â”€ OutputFormatter.ts        # è¾“å‡ºæ ¼å¼åŒ–
â”‚   â””â”€â”€ OutputWriter.ts           # è¾“å‡ºå†™å…¥
â””â”€â”€ types/
    â””â”€â”€ interfaces.ts              # ç±»å‹å®šä¹‰
```

## @vscode/test-electron é›†æˆæµ‹è¯•æ–¹æ¡ˆ

**æŠ€æœ¯ç‰¹ç‚¹**:
- å®˜æ–¹æ¨èçš„VSCodeæ‰©å±•æµ‹è¯•æ¡†æ¶
- ä¸ç°æœ‰ä»£ç å®Œå…¨å…¼å®¹
- æ”¯æŒçœŸå®VSCodeç¯å¢ƒæµ‹è¯•

**å®æ–½ä»»åŠ¡**:
1. **å‡çº§ç°æœ‰æ¡†æ¶**
   - æ£€æŸ¥@vscode/test-electronæœ€æ–°ç‰ˆæœ¬(å½“å‰2.5.2)
   - å‡çº§Mochaåˆ°æœ€æ–°ç‰ˆæœ¬
   - ä¼˜åŒ–æµ‹è¯•é…ç½®å’Œè¿è¡Œå™¨

2. **åˆ›å»ºç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ç”¨ä¾‹**:
   ```typescript
   // æ’ä»¶ç”Ÿå‘½å‘¨æœŸæµ‹è¯•
   test('æ’ä»¶æ¿€æ´»å’Œåœç”¨å®Œæ•´æµç¨‹', async () => {
     // æ¿€æ´»æ’ä»¶ -> éªŒè¯åˆå§‹åŒ– -> åœç”¨æ’ä»¶ -> éªŒè¯æ¸…ç†
   });
   
   // æ–‡ä»¶ç›‘å¬é›†æˆæµ‹è¯•
   test('æ–‡ä»¶å˜åŒ–ç›‘å¬å’Œè¾“å‡ºå®Œæ•´æµç¨‹', async () => {
     // æ‰“å¼€æ–‡ä»¶ -> åˆ‡æ¢æ–‡ä»¶ -> éªŒè¯è¾“å‡ºæ–‡ä»¶ç”Ÿæˆ -> éªŒè¯å†…å®¹æ ¼å¼
   });
   
   // å¤šå·¥ä½œåŒºæµ‹è¯•
   test('å¤šå·¥ä½œåŒºç¯å¢ƒä¸‹çš„åŠŸèƒ½æµ‹è¯•', async () => {
     // åˆ›å»ºå¤šå·¥ä½œåŒº -> æµ‹è¯•æ–‡ä»¶è¿½è¸ª -> éªŒè¯è¾“å‡ºåˆ†ç¦»
   });
   
   // é…ç½®å˜æ›´æµ‹è¯•
   test('è¿è¡Œæ—¶é…ç½®å˜æ›´å“åº”æµ‹è¯•', async () => {
     // ä¿®æ”¹é…ç½® -> éªŒè¯è¡Œä¸ºå˜åŒ– -> æµ‹è¯•çƒ­æ›´æ–°
   });
   ```

3. **æ€§èƒ½å’Œç¨³å®šæ€§æµ‹è¯•**
   - å¤§é‡æ–‡ä»¶åœºæ™¯æµ‹è¯•
   - é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•
   - å†…å­˜æ³„æ¼æ£€æµ‹

**å®æ–½æ­¥éª¤**:
1. å‡çº§æµ‹è¯•ä¾èµ–
2. é‡æ„ç°æœ‰æµ‹è¯•ç»“æ„
3. æ·»åŠ å®Œæ•´é›†æˆæµ‹è¯•ç”¨ä¾‹
4. ä¼˜åŒ–æµ‹è¯•è¦†ç›–ç‡


## é›†æˆæµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

åŸºç¡€æµ‹è¯•ç”¨ä¾‹æ¥éªŒè¯@vscode/test-electronæ–¹æ¡ˆå¯è¡Œæ€§:

### 1. æ’ä»¶åŠ è½½æµ‹è¯•
```typescript
test('æ’ä»¶æ­£ç¡®åŠ è½½å’Œæ¿€æ´»', async () => {
  // éªŒè¯æ’ä»¶æ¿€æ´»
  // éªŒè¯å‘½ä»¤æ³¨å†Œ
  // éªŒè¯é…ç½®è¯»å–
});
```

### 2. åŸºç¡€åŠŸèƒ½æµ‹è¯•
```typescript
test('æ–‡ä»¶ç›‘å¬â†’å†…å®¹æ”¶é›†â†’æ ¼å¼åŒ–è¾“å‡º å®Œæ•´æµç¨‹', async () => {
  // æ‰“å¼€æµ‹è¯•æ–‡ä»¶
  // è§¦å‘æ–‡ä»¶å˜åŒ–äº‹ä»¶
  // éªŒè¯è¾“å‡ºæ–‡ä»¶ç”Ÿæˆ
  // éªŒè¯è¾“å‡ºå†…å®¹æ ¼å¼
});
```

### 3. é…ç½®è¯»å–æµ‹è¯•
```typescript
test('é…ç½®é¡¹æ­£ç¡®è¯»å–å’Œåº”ç”¨', async () => {
  // æµ‹è¯•é»˜è®¤é…ç½®
  // æµ‹è¯•è‡ªå®šä¹‰é…ç½®
  // æµ‹è¯•é…ç½®å˜æ›´å“åº”
});
```

### 4. é”™è¯¯å¤„ç†æµ‹è¯•
```typescript
test('å¼‚å¸¸æƒ…å†µå¤„ç†', async () => {
  // æ— æ•ˆè·¯å¾„å¤„ç†
  // æƒé™é”™è¯¯å¤„ç†
  // ç©ºæ–‡ä»¶å¤„ç†
});
```

## å®æ–½è¿›å±•

### âœ… å®æ–½è¿›å±• - @vscode/test-electron

**å®æ–½æ—¶é—´**: å½“å‰
**å®æ–½æ–‡ä»¶**: `src/test/suite/extension.test.ts`

**å·²å®ç°åŠŸèƒ½**:
1. **æ ¸å¿ƒæµç¨‹é›†æˆæµ‹è¯•**: 
   - ContextTrackeråˆå§‹åŒ–æµ‹è¯•
   - é…ç½®ç®¡ç†å™¨Mockæµ‹è¯•
   - å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæµ‹è¯• (åˆ›å»ºâ†’åˆå§‹åŒ–â†’æ¸…ç†)
   - å¼‚å¸¸å¤„ç†éªŒè¯

2. **æ‰©å±•å‘½ä»¤æ³¨å†Œæµ‹è¯•**:
   - éªŒè¯`auto-context.removeTopCommentBlocks`å‘½ä»¤æ­£ç¡®æ³¨å†Œ
   - é€šè¿‡VSCode APIæ£€æŸ¥å‘½ä»¤å¯ç”¨æ€§

**æµ‹è¯•ç‰¹ç‚¹**:
- åŸºäºç°æœ‰@vscode/test-electron + Mochaæ¡†æ¶
- é›¶å­¦ä¹ æˆæœ¬ï¼Œå®Œå…¨å…¼å®¹ç°æœ‰ä»£ç 
- è¦†ç›–æ’ä»¶æœ€å…³é”®çš„åˆå§‹åŒ–æµç¨‹
- åŒ…å«ä¸´æ—¶æ–‡ä»¶ç®¡ç†å’Œæ¸…ç†

**æ‰§è¡Œç»“æœ**:
- âœ… TypeScriptç¼–è¯‘é€šè¿‡
- âœ… ESLintä»£ç æ£€æŸ¥é€šè¿‡  
- âœ… Webpackæ‰“åŒ…æˆåŠŸ
- ğŸ”„ VSCodeæµ‹è¯•ç¯å¢ƒå‡†å¤‡ä¸­

**æµ‹è¯•æ‰§è¡Œå‘½ä»¤**:
```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰
npm run test

# å®Œæ•´æµ‹è¯•æµç¨‹
npm run compile-tests  # ç¼–è¯‘æµ‹è¯•æ–‡ä»¶
npm run compile        # ç¼–è¯‘æ‰©å±•ä»£ç 
npm run lint          # ä»£ç æ£€æŸ¥
npm run test          # è¿è¡Œæµ‹è¯•

# ä¸€é”®å®Œæ•´æµ‹è¯•
npm run pretest && npm run test

# å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
npm run watch-tests   # ç›‘å¬æµ‹è¯•æ–‡ä»¶
npm run watch        # ç›‘å¬æºç æ–‡ä»¶
```

**ä»£ç ç¤ºä¾‹**:
```typescript
test('æ ¸å¿ƒæµç¨‹é›†æˆæµ‹è¯•: ContextTrackeråˆå§‹åŒ–å’ŒåŸºç¡€åŠŸèƒ½', () => {
  // Mocké…ç½®ç®¡ç†å™¨
  class MockConfigManager {
    getConfiguration(): ExtensionConfig { /* ... */ }
  }
  
  // æµ‹è¯•å®Œæ•´ç”Ÿå‘½å‘¨æœŸ
  const contextTracker = new ContextTracker(mockConfigManager);
  contextTracker.initialize();
  contextTracker.dispose();
});
```

## åç»­ä¼˜åŒ–è®¡åˆ’

- **çŸ­æœŸ**: æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•ç”¨ä¾‹è¦†ç›–
- **ä¸­æœŸ**: é›†æˆCI/CDè‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹  
- **é•¿æœŸ**: è¯„ä¼°æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡æŒ‡æ ‡